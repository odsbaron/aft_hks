/**
 * Login Modal Component
 *
 * A modal for users to sign in using various social accounts.
 * Powered by Privy for embedded wallet creation.
 */

"use client";

import { useState, useEffect } from "react";
import { usePrivyAuth } from "~~/hooks/usePrivy";

interface LoginModalProps {
  isOpen: boolean;
  onClose: () => void;
}

export function LoginModal({ isOpen, onClose }: LoginModalProps) {
  const { ready, login, authenticated } = usePrivyAuth();
  const [isLogging, setIsLogging] = useState(false);
  const [error, setError] = useState("");

  useEffect(() => {
    if (authenticated) {
      onClose();
    }
    if (isOpen) {
      setError("");
    }
  }, [authenticated, isOpen, onClose]);

  const handleLogin = async () => {
    setError("");
    setIsLogging(true);

    try {
      await login();
    } catch (err: any) {
      console.error("Login failed:", err);
      setError(err.message || "Failed to login. Please try again.");
    } finally {
      setIsLogging(false);
    }
  };

  if (!isOpen) return null;

  return (
    <dialog className="modal modal-open">
      <div className="modal-box max-w-md">
        {/* Close Button */}
        <button
          className="btn btn-sm btn-circle btn-absolute right-4 top-4 btn-ghost"
          onClick={onClose}
          disabled={isLogging}
        >
          âœ•
        </button>

        {/* Header */}
        <div className="text-center mb-6">
          <div className="text-4xl mb-2">ðŸŽ²</div>
          <h3 className="font-bold text-xl">Welcome to Sidebets</h3>
          <p className="text-sm text-base-content/60 mt-1">
            Sign in to start betting on social consensus markets
          </p>
        </div>

        {/* Loading State */}
        {!ready && (
          <div className="flex flex-col items-center py-8">
            <span className="loading loading-spinner loading-lg text-primary"></span>
            <p className="text-sm text-base-content/60 mt-4">Loading authentication...</p>
          </div>
        )}

        {/* Login Options */}
        {ready && (
          <div className="space-y-3">
            {/* Email Login */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z"/>
              </svg>
              <span>Continue with Email</span>
            </button>

            {/* Google */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
              </svg>
              <span>Continue with Google</span>
            </button>

            {/* Twitter/X */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
              <span>Continue with X / Twitter</span>
            </button>

            {/* Discord */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24" fill="#5865F2">
                <path d="M20.317 4.37a19.7913 19.7913 0 00-4.8851-1.5152.0741.0741 0 00-.0785.0371c-.211.3753-.4447.8648-.6083 1.2495-1.8447-.2762-3.68-.2762-5.4868 0-1.8428.2762-3.6422.6083-1.2495.1636-.8742.3973-1.2495.6083a.077.077 0 00-.0785-.037 19.7363 19.7363 0 00-4.8852 1.515.0699.0699 0 01-.0321.0277C.5334 9.0458-.319 13.5799.0992 18.0578a.084.084 0 00.0312.056 19.9 19.9 0 005.9932-1.463 19.9 19.9 0 005.9932 1.463.084.084 0 00.0312-.056c.4184-4.4779-.4342-9.0119-3.9853-12.6783a.069.069 0 00-.0321-.0277zM16.3455 17.2262c-1.1366 2.5541-3.5809 3.6986-5.7629 3.6986-2.182 0-4.6263-1.1445-5.7629-3.6986-.6251-1.4042-1.1138-2.9034-1.1138-4.4753 0-3.4291 2.7816-6.2107 6.2107-6.2107 3.4291 0 6.2107 2.7816 6.2107 6.2107 0 1.5719-.4886 3.0711-1.1138 2.182-1.1366 4.6263-3.6986 5.7629-3.6986 2.182 0 3.6986 1.1445 5.7629 3.6986.6251 1.4042 1.1138 2.9034 1.1138 4.4753 0 3.4291-2.7816 6.2107-6.2107 6.2107-3.4291 0-6.2107-2.7816-6.2107-6.2107 0-1.5719.4886-3.0711 1.1138z"/>
              </svg>
              <span>Continue with Discord</span>
            </button>

            {/* Telegram */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12 text-sky-500"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.92 1.03-.78.04-1.62-.38-2.84-.61-2.53-.47-4.71.32-6.13.96-.56.26-.97.86-1.04 1.45-.06.53.36 1.31 1.12 1.54.74.22 1.5.46 2.25.69 2.08.62 4.17.19 6.25-.96.58-.27 1.07-.8 1.14-1.42.07-.62-.42-1.63-.75-2.15-.28-.43-.57-.87-.86-1.3.04.41.09.82.13 1.23-.13 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.92 1.03z"/>
              </svg>
              <span>Continue with Telegram</span>
            </button>

            {/* Farcaster */}
            <button
              className="btn btn-outline w-full justify-start gap-3 h-12"
              onClick={handleLogin}
              disabled={isLogging}
            >
              <svg className="w-5 h-5" viewBox="0 0 24 24" fill="#855DCD">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-8.8 0-1.35.91-2.75 2.35-2.75 1.77 0 3.34 1.38 4.2 1.38.86 0 2.05-.66 2.05-1.54 0-.8-.63-1.33-2.2-1.71-.82-.2-1.28-.52-1.28-.9 0-.54.71-.99 1.94-.99 1.35 0 2.58.69 3.4.69.61 0 1.05-.27 1.05-.64 0-.43-.46-.69-1.43-.87-1.05-.2-2.16-.27-2.16-.97 0-.7.63-1.42 1.8-1.42 1.09 0 2.05.62 2.66.62.43 0 .75-.2.75-.47 0-.28-.22-.45-.78-.58-1.59-.43-3.32-.19-3.32 1.99 0 1.47.97 2.76 2.76 2.76 1.09 0 1.88-.58 1.88-1.37 0-.83-.77-1.33-2.31-1.33-1.53 0-2.76 1.23-2.76 2.76 0 1.32.94 2.29 2.2 2.29.59 0 .99-.34.99-.82 0-.51-.44-.82-1.18-.96-1.4-.27-2.97.09-2.97 1.76 0 1.25.83 2.31 2.31 2.31.69 0 1.16-.37 1.16-.89 0-.59-.53-.95-1.52-1.13-.82-.15-1.7-.15-1.7.72 0 .49.37.9 1.11 1.22.53.26.85.41 1.32.41 1.7 0 .78-.64 1.51-1.63 1.72-.29.06-.59.06-.59.06.17 0 .48.09.89.27 1.22-.3.49-.76.76-1.44.76-1.12 0-1.86-.59-1.86-1.42 0-.96.83-1.59 2.12-1.59 1.12 0 1.97.64 2.54.64.46 0 .76-.25.76-.61 0-.41-.34-.66-1.11-.82-.82-.19-1.7-.19-1.7.7 0 .45.33.82.97 1.12.48.29.75.22 1.14.22 1.4 0 .67-.55 1.3-1.39 1.47-.25.05-.51.05-.51.05.15 0 .43.09.81.27 1.12-.27.45-.68.69-1.28.69-.98 0-1.63-.52-1.63-1.26 0-.83.71-1.38 1.85-1.38 1.02 0 1.79.58 2.32.58.42 0 .69-.23.69-.57 0-.38-.31-.6-.97-.76-.76-.18-1.57-.18-1.57.65 0 .42.31.76.9 1.03.43.27.67.2 1.01.2 1.24 0 .62-.51 1.2-1.27 1.36-.23.05-.46.05-.46.05.13 0 .37.08.68.24.96-.24.41-.6.63-1.13.63-.87 0-1.45-.46-1.45-1.12 0-.74.63-1.22 1.66-1.22.91 0 1.6.52 2.07.52.38 0 .62-.2.62-.52 0-.34-.28-.54-.87-.68-.68-.16-1.4-.16-1.4.59 0 .38.28.69.79.98.4.25.62.19.94.19 1.15 0 .57-.47 1.11-1.17 1.26-.21.05-.43.05-.43.05.12 0 .34.07.63.22.89-.22.38-.56.58-1.05.58-.78 0-1.3-.42-1.3-1.03 0-.66.56-1.09 1.47-1.09.81 0 1.42.46 1.84.46.34 0 .56-.18.56-.46 0-.3-.25-.48-.78-.6-.6-.15-1.24-.15-1.24.52 0 .33.25.61.68.88.26.37.18.56.18.73 0 .54-.44 1.05-1.08 1.19-.2.04-.4.04-.4.04.11 0 .31.06.58.21.82-.21.36-.53.55-1 .55-.73 0-.39-.33-.64-.85-.76-.57-.14-1.17-.14-1.17.48 0 .31.23.57.63.8.23.29.17.44.17.59 0 .48-.39.93-.92.93-.47 0-.78-.25-.78-.61 0-.37.32-.6.83-.6-.5-.12-1.03-.12-1.03.43 0 .28.21.51.57.8.2.27.13.41.13.52 0 .45-.36.88-.86.88-.44 0-.74-.23-.74-.57 0-.34.29-.55.76-.55.46 0 .77.4 1.34 1.34.32 0 .52-.17.52-.44 0-.27-.23-.44-.6-.52-.43-.11-.88-.11-.88.4 0 .26.2.48.53.73.19.24.12.37.12.46 0 .43-.34.84-.83.84-.41 0-.68-.21-.68-.53 0-.32.27-.52.71-.52.43 0 .72.37 1.24 1.24.3 0 .48-.25.48-.52 0-.27-.22-.44-.58-.51-.39-.1-.8-.1-.8.38 0 .24.18.44.47.65.18.22.11.35.11.42 0 .4-.32.78-.78.78-.38 0-.64-.2-.64-.49 0-.3.25-.48.66-.48.4 0 .67.35 1.15 1.15.28 0 .45-.23.45-.47 0-.25-.21-.41-.54-.47-.36-.09-.74-.09-.74.36 0 .23.17.42.44.62.17.21.1.33.1.39 0 .37-.3.73-.73.73-.36 0-.6-.18-.6-.46 0-.29.24-.47.62-.47.38 0 .64.35 1.1 1.1.26 0 .43-.22.43-.45 0-.24-.2-.39-.51-.45-.34-.08-.69-.08-.69.34 0 .22.16.4.41.57.16.2.09.31.09.36 0 .4-.32.77-.77.77-.39 0-.65-.2-.65-.47 0-.27.23-.44.59-.44.37 0 .61.33 1.06 1.06.25 0 .4-.21.4-.43 0-.23-.19-.37-.49-.42-.33-.07-.67-.07-.67.32 0 .2.15.37.38.53.15.19.09.29.09.33 0 .36-.29.71-.71.71-.36 0-.6-.18-.6-.43 0-.26.22-.42.55-.42.35 0 .58.31 1 .1.24 0 .39-.2.39-.42 0-.22-.18-.36-.46-.4-.3-.06-.61-.06-.61.29 0 .18.14.33.35.48.14.18.08.27.08.3 0 .34-.27.67-.67.67-.33 0-.56-.17-.56-.4 0-.25.21-.4.52-.4.33 0 .55.47.95.95.23 0 .37-.19.37-.39 0-.2-.17-.33-.43-.37-.29-.06-.58-.06-.58.27 0 .17.13.31.35.43.13.17.08.25.08.28 0 .32-.26.62-.62.62-.31 0-.52-.16-.52-.37 0-.24.2-.38.49-.38.31 0 .51.44.88.88.21 0 .35-.18.35-.36 0-.19-.16-.31-.41-.35-.26-.05-.53-.05-.53.24 0 .15.12.28.32.43.12.15.07.23.07.25 0 .29-.23.56-.56.56-.28 0-.47-.14-.47-.33 0-.22.19-.35.46-.35.29 0 .48.42.83.83.2 0 .33-.17.33-.34 0-.17-.15-.27-.38-.33-.23-.04-.47-.04-.47.21 0 .14.1.25.27.38.1.13.06.2.06.22 0 .26-.21.51-.51.51-.25 0-.42-.13-.42-.3 0-.2.16-.32.41-.32.25 0 .43.37.75.75.18 0 .3-.15.3-.31 0-.16-.14-.25-.35-.31-.19-.04-.39-.04-.39.17 0 .12.09.22.23.33.09.11.05.17.05.19 0 .23-.18.44-.44.44-.22 0-.37-.11-.37-.26 0-.17.14-.27.36-.27.23 0 .38.33.66.66.16 0 .26-.13.26-.27 0-.14-.12-.22-.3-.26-.16-.03-.33-.03-.33.13 0 .09.06.16.19.23.06.09.04.14.04.14 0 .2-.15.38-.38.38-.19 0-.32-.1-.32-.22 0-.14.11-.22.28-.22.18 0 .3.26.52.52.13 0 .22-.11.22-.22 0-.11-.1-.17-.25-.2-.12-.02-.25-.02-.25.09 0 .06.04.12.15.17.04.07.03.1.03.1 0 .14-.11.27-.27.27-.14 0-.23-.07-.23-.17 0-.11.09-.17-.21-.17-.07-.01-.15-.01-.15.06 0 .04.03.08.12.11.03.05.02.07.02.07 0 .1-.08.19-.19.19-.1 0-.17-.05-.17-.13 0-.08.06-.13-.16-.13-.05 0-.1 0-.1.03z"/>
              </svg>
              <span>Continue with Farcaster</span>
            </button>
          </div>
        )}

        {/* Error Message */}
        {error && (
          <div className="alert alert-error text-sm py-2 mt-4">
            <span>{error}</span>
          </div>
        )}

        {/* Terms */}
        <p className="text-xs text-center text-base-content/60 mt-6">
          By connecting, you agree to our{" "}
          <a href="/terms" className="link link-primary">
            Terms of Service
          </a>{" "}
          and{" "}
          <a href="/privacy" className="link link-primary">
            Privacy Policy
          </a>
        </p>
      </div>
      <div className="modal-backdrop" onClick={onClose}></div>
    </dialog>
  );
}
